<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>DnL Map</title>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link href="css/literallycanvas.css" rel="stylesheet">

	    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	    <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.js"></script>
	    <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>

	    <script src="js/literallycanvas.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="dnl"></div>

			<form class="imgur-submit">
			    <input type="submit" data-action="upload-to-imgur" value="Upload to Imgur">
			</form>

			<script>
			  $(document).ready(function() {
			    var backgroundImage = new Image()
			    backgroundImage.src = 'img/dnl_map.png';

			    var lc = LC.init(
			        document.getElementsByClassName('dnl')[0], {
			        	imageSize: {width: 1003, height: 681},
			          backgroundShapes: [
			            LC.createShape(
			              'Image', {x: 0, y: 0, image: backgroundImage, scale: 1})
			          ]
			        });
			    lc.setImageSize(1003, 681);
			    // the background image is not included in the shape list that is
			    // saved/loaded here
			    var localStorageKey = 'drawing-with-background'
			    if (localStorage.getItem(localStorageKey)) {
			      lc.loadSnapshotJSON(localStorage.getItem(localStorageKey));
			    }
			    lc.on('drawingChange', function() {
			      localStorage.setItem(localStorageKey, lc.getSnapshotJSON());
			    });
			    //$('.controls.export [data-action=export-as-png]').click(function(e) {
			      //e.preventDefault();
			      //window.open(lc.getImage().toDataURL());
			    //});
			    $('[data-action=upload-to-imgur]').click(function(e) {
			      e.preventDefault();

			      $('.imgur-submit').html('Uploading...')

			      // this is all standard Imgur API; only LC-specific thing is the image
			      // data argument;
			      $.ajax({
			        url: 'https://api.imgur.com/3/image',
			        type: 'POST',
			        headers: {
			          // Your application gets an imgurClientId from Imgur
			          Authorization: 'Client-ID ' + imgurClientId,
			          Accept: 'application/json'
			        },
			        data: {
			          // convert the image data to base64
			          image:  lc.canvasForExport().toDataURL().split(',')[1],
			          type: 'base64'
			        },
			        success: function(result) {
			          var url = 'https://imgur.com/gallery/' + result.data.id;
			          $('.imgur-submit').html("<a href='" + url + "'>" + url + "</a>");
			        },
			      });
			    });
			  });
			</script>
		</div>
	</body>
</html>
